# å±å¹•å½•åˆ¶æ¨æµç³»ç»Ÿ

ä¸€ä¸ªåŸºäºPythonçš„å±å¹•å½•åˆ¶æ¨æµç³»ç»Ÿï¼Œæ”¯æŒå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯æ¨æµï¼ŒæœåŠ¡ç«¯æä¾›Webç•Œé¢å’ŒAPIæ¥å£ã€‚

## é¡¹ç›®ç»“æ„

```
stream2front/
â”œâ”€â”€ app.py              # åŸå§‹å•æœºç‰ˆåº”ç”¨ï¼ˆä¿ç•™ä¸å˜ï¼‰
â”œâ”€â”€ server.py           # æœåŠ¡ç«¯ç¨‹åº
â”œâ”€â”€ client.py           # å®¢æˆ·ç«¯ç¨‹åº
â”œâ”€â”€ screen_recorder.py  # å±å¹•å½•åˆ¶æ ¸å¿ƒç±»
â”œâ”€â”€ requirements.txt    # ä¾èµ–åŒ…åˆ—è¡¨
â”œâ”€â”€ templates/
â”‚   â””â”€â”€ index.html     # Webç•Œé¢æ¨¡æ¿
â””â”€â”€ README.md          # è¯´æ˜æ–‡æ¡£
```

## åŠŸèƒ½ç‰¹æ€§

### æœåŠ¡ç«¯ (server.py)
- ğŸŒ Webä¸»é¡µé¢å±•ç¤º
- ğŸ“¹ è§†é¢‘æµAPIæ¥å£ (`/api/v1/video_feed`)
- ğŸ“¸ æˆªå›¾APIæ¥å£ (`/api/v1/screenshot`)
- ğŸ“¡ æ¥æ”¶å®¢æˆ·ç«¯æ¨æµ (`/api/v1/push_frame`)
- ğŸ“Š æœåŠ¡çŠ¶æ€æŸ¥è¯¢ (`/api/v1/status`)
- ğŸ”„ æ”¯æŒå¤šå®¢æˆ·ç«¯æ¨æµï¼ˆæœ€æ–°å¸§è¦†ç›–ï¼‰
- ğŸ›¡ï¸ é”™è¯¯å¤„ç†å’Œå¼‚å¸¸æ¢å¤

### å®¢æˆ·ç«¯ (client.py)
- ğŸ–¥ï¸ å®æ—¶å±å¹•æ•è·
- ğŸ“¤ å‘æœåŠ¡ç«¯æ¨æµ
- âš™ï¸ å¯é…ç½®å¸§ç‡å’Œå›¾åƒè´¨é‡
- ğŸ“ˆ å®æ—¶ç»Ÿè®¡ä¿¡æ¯
- ğŸ”— è¿æ¥çŠ¶æ€ç›‘æ§
- ğŸ›ï¸ å‘½ä»¤è¡Œå‚æ•°æ”¯æŒ

## å®‰è£…ä¾èµ–

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
uv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source .venv/bin/activate  # macOS/Linux
# æˆ–
.venv\Scripts\activate     # Windows

# å®‰è£…ä¾èµ–
uv pip install -r requirements.txt
```

## ä½¿ç”¨æ–¹æ³•

### 1. å¯åŠ¨æœåŠ¡ç«¯

```bash
# åŸºæœ¬å¯åŠ¨
python server.py

# æˆ–ä½¿ç”¨uvè¿è¡Œ
uv run python server.py
```

æœåŠ¡ç«¯å¯åŠ¨åä¼šæ˜¾ç¤ºï¼š
```
==================================================
å±å¹•å½•åˆ¶æœåŠ¡ç«¯å¯åŠ¨ä¸­...
å¯åŠ¨æ—¶é—´: 2024-01-01 12:00:00
==================================================

å¯ç”¨æ¥å£:
  ä¸»é¡µé¢:     http://localhost:8080/
  è§†é¢‘æµ:     http://localhost:8080/api/v1/video_feed
  æˆªå›¾:       http://localhost:8080/api/v1/screenshot
  æ¨æµæ¥æ”¶:   http://localhost:8080/api/v1/push_frame
  çŠ¶æ€æŸ¥è¯¢:   http://localhost:8080/api/v1/status

æŒ‰ Ctrl+C åœæ­¢æœåŠ¡
==================================================
```

### 2. å¯åŠ¨å®¢æˆ·ç«¯æ¨æµ

```bash
# åŸºæœ¬æ¨æµï¼ˆé»˜è®¤è¿æ¥localhost:8080ï¼‰
python client.py

# æŒ‡å®šæœåŠ¡ç«¯åœ°å€
python client.py --server http://192.168.1.100:8080

# è‡ªå®šä¹‰å‚æ•°
python client.py --server http://192.168.1.100:8080 --fps 30 --quality 90

# ä»…æµ‹è¯•è¿æ¥
python client.py --test
```

#### å®¢æˆ·ç«¯å‚æ•°è¯´æ˜

| å‚æ•° | ç®€å†™ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `--server` | `-s` | `http://localhost:8080` | æœåŠ¡ç«¯URLåœ°å€ |
| `--fps` | `-f` | `20` | æ¨æµå¸§ç‡ (1-60) |
| `--quality` | `-q` | `80` | JPEGå‹ç¼©è´¨é‡ (1-100) |
| `--test` | `-t` | - | ä»…æµ‹è¯•è¿æ¥ï¼Œä¸å¼€å§‹æ¨æµ |

### 3. è®¿é—®Webç•Œé¢

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š`http://localhost:8080`

## APIæ¥å£æ–‡æ¡£

### GET /
ä¸»é¡µé¢ï¼Œæ˜¾ç¤ºè§†é¢‘æµç•Œé¢

### GET /api/v1/video_feed
è·å–MJPEGæ ¼å¼çš„è§†é¢‘æµ
- **å“åº”æ ¼å¼**: `multipart/x-mixed-replace; boundary=frame`
- **ç”¨é€”**: åœ¨ç½‘é¡µä¸­åµŒå…¥è§†é¢‘æµ

### GET /api/v1/screenshot
è·å–å½“å‰å±å¹•æˆªå›¾
- **å“åº”æ ¼å¼**: `image/png`
- **ç”¨é€”**: è·å–å•å¼ æˆªå›¾

### POST /api/v1/push_frame
æ¥æ”¶å®¢æˆ·ç«¯æ¨é€çš„å¸§æ•°æ®
- **è¯·æ±‚æ ¼å¼**: `multipart/form-data`
- **å‚æ•°**: `frame` (å›¾åƒæ–‡ä»¶)
- **å“åº”æ ¼å¼**: `application/json`

**è¯·æ±‚ç¤ºä¾‹**:
```bash
curl -X POST -F "frame=@screenshot.jpg" http://localhost:8080/api/v1/push_frame
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "status": "success",
  "message": "å¸§æ•°æ®æ¥æ”¶æˆåŠŸ",
  "timestamp": "2024-01-01T12:00:00.000000"
}
```

### GET /api/v1/status
è·å–æœåŠ¡çŠ¶æ€ä¿¡æ¯
- **å“åº”æ ¼å¼**: `application/json`

**å“åº”ç¤ºä¾‹**:
```json
{
  "status": "running",
  "timestamp": "2024-01-01T12:00:00.000000",
  "has_client_stream": true,
  "server_info": {
    "host": "0.0.0.0",
    "port": 8080,
    "endpoints": {
      "home": "/",
      "video_feed": "/api/v1/video_feed",
      "screenshot": "/api/v1/screenshot",
      "push_frame": "/api/v1/push_frame",
      "status": "/api/v1/status"
    }
  }
}
```

## ä½¿ç”¨åœºæ™¯

### 1. æœ¬åœ°æµ‹è¯•
```bash
# ç»ˆç«¯1: å¯åŠ¨æœåŠ¡ç«¯
python server.py

# ç»ˆç«¯2: å¯åŠ¨å®¢æˆ·ç«¯
python client.py

# æµè§ˆå™¨: è®¿é—® http://localhost:8080
```

### 2. è¿œç¨‹æ¨æµ
```bash
# æœåŠ¡ç«¯æœºå™¨ (IP: 192.168.1.100)
python server.py

# å®¢æˆ·ç«¯æœºå™¨
python client.py --server http://192.168.1.100:8080
```

### 3. é«˜è´¨é‡æ¨æµ
```bash
# 30fps, 95%è´¨é‡
python client.py --fps 30 --quality 95
```

### 4. ä½å¸¦å®½æ¨æµ
```bash
# 10fps, 50%è´¨é‡
python client.py --fps 10 --quality 50
```

## VSCodeå¿«æ·é”®æç¤º

åœ¨macOSçš„VSCodeä¸­å¼€å‘æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å¿«æ·é”®æé«˜æ•ˆç‡ï¼š

| åŠŸèƒ½ | å¿«æ·é”® | è¯´æ˜ |
|------|--------|------|
| ä»£ç è¡¥å…¨ | `Tab` | è¾“å…¥å‡ ä¸ªå­—æ¯åæŒ‰Tabè‡ªåŠ¨è¡¥å…¨ |
| æ™ºèƒ½æç¤º | `Ctrl + Space` | æ˜¾ç¤ºä»£ç æç¤ºå’Œè¡¥å…¨é€‰é¡¹ |
| å¿«é€Ÿä¿®å¤ | `Cmd + .` | æ˜¾ç¤ºå¿«é€Ÿä¿®å¤å»ºè®® |
| æ ¼å¼åŒ–ä»£ç  | `Shift + Option + F` | è‡ªåŠ¨æ ¼å¼åŒ–å½“å‰æ–‡ä»¶ |
| è¿è¡ŒPython | `Cmd + F5` | è¿è¡Œå½“å‰Pythonæ–‡ä»¶ |
| æ‰“å¼€ç»ˆç«¯ | `Ctrl + `` ` | æ‰“å¼€é›†æˆç»ˆç«¯ |
| æ–‡ä»¶æœç´¢ | `Cmd + P` | å¿«é€Ÿæ‰“å¼€æ–‡ä»¶ |
| å…¨å±€æœç´¢ | `Cmd + Shift + F` | åœ¨é¡¹ç›®ä¸­æœç´¢ |
| å¤šå…‰æ ‡ç¼–è¾‘ | `Option + Click` | åœ¨å¤šä¸ªä½ç½®æ”¾ç½®å…‰æ ‡ |
| å¤åˆ¶è¡Œ | `Shift + Option + â†“` | å‘ä¸‹å¤åˆ¶å½“å‰è¡Œ |

## æ•…éšœæ’é™¤

### 1. ç«¯å£å ç”¨
å¦‚æœ8080ç«¯å£è¢«å ç”¨ï¼Œå¯ä»¥ä¿®æ”¹server.pyä¸­çš„ç«¯å£å·ï¼š
```python
app.run(host='0.0.0.0', port=8081, debug=False, threaded=True)
```

### 2. æƒé™é—®é¢˜
macOSå¯èƒ½éœ€è¦æˆæƒå±å¹•å½•åˆ¶æƒé™ï¼š
- ç³»ç»Ÿåå¥½è®¾ç½® â†’ å®‰å…¨æ€§ä¸éšç§ â†’ éšç§ â†’ å±å¹•å½•åˆ¶
- æ·»åŠ Terminalæˆ–Pythonåˆ°å…è®¸åˆ—è¡¨

### 3. ç½‘ç»œè¿æ¥é—®é¢˜
æ£€æŸ¥é˜²ç«å¢™è®¾ç½®ï¼Œç¡®ä¿8080ç«¯å£å¯ä»¥è®¿é—®ã€‚

### 4. ä¾èµ–å®‰è£…é—®é¢˜
```bash
# å‡çº§pip
pip install --upgrade pip

# é‡æ–°å®‰è£…ä¾èµ–
pip install -r requirements.txt --force-reinstall
```

## æŠ€æœ¯æ¶æ„

- **åç«¯æ¡†æ¶**: Flask
- **å±å¹•æ•è·**: mss + OpenCV
- **å›¾åƒå¤„ç†**: OpenCV (cv2)
- **HTTPå®¢æˆ·ç«¯**: requests
- **è§†é¢‘æµ**: MJPEG over HTTP
- **å¹¶å‘å¤„ç†**: Threading

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **è°ƒæ•´å¸§ç‡**: æ ¹æ®ç½‘ç»œå¸¦å®½è°ƒæ•´FPS
2. **å‹ç¼©è´¨é‡**: å¹³è¡¡å›¾åƒè´¨é‡å’Œä¼ è¾“é€Ÿåº¦
3. **ç½‘ç»œä¼˜åŒ–**: ä½¿ç”¨æœ‰çº¿ç½‘ç»œè·å¾—æ›´ç¨³å®šçš„ä¼ è¾“
4. **ç¡¬ä»¶åŠ é€Ÿ**: ä½¿ç”¨æ€§èƒ½æ›´å¥½çš„æœºå™¨ä½œä¸ºå®¢æˆ·ç«¯

## è®¸å¯è¯

MIT License